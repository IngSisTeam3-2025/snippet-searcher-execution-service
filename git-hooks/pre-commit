#!/bin/sh
echo ""
echo " Ejecutando pre-commit checks..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# Detekt (linter)
echo "  1️) Ejecutando Detekt (linter)..."
./gradlew detekt --console=plain -q
DETEKT_EXIT=$?

if [ $DETEKT_EXIT -ne 0 ]; then
    echo ""
    echo "❌ Detekt encontró problemas de código."
    echo "   Revisá los errores arriba y corregí antes de commitear."
    echo ""
    exit 1
fi
echo "     ✅ Detekt pasó"

# Spotless (formatter check)
echo "  2️) Ejecutando Spotless Check (formatter)..."
./gradlew spotlessCheck --console=plain -q
SPOTLESS_EXIT=$?

if [ $SPOTLESS_EXIT -ne 0 ]; then
    echo ""
    echo "❌ Código sin formatear correctamente."
    echo "   Ejecutá: ./gradlew spotlessApply"
    echo "   Y volvé a intentar el commit."
    echo ""
    exit 1
fi
echo "     ✅ Spotless pasó"

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✅ Pre-commit checks completados exitosamente!"
echo ""